var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{A:()=>s});class s{onbin=null;ontext=null;async onopen(){}async onclose(){}async onerror(e){}async onportchange(e){}constructor(){this._ok="serial"in navigator,this._ok?this._update().then((()=>this.onportchange(this.selected()))):this._error("Browser is not supported")}opened(){return this._open}selected(){return!!this._port}getName(){if(!this._port)return"None";switch(this._port.getInfo().usbProductId){case 21971:return"CH343";case 30084:return"CH340S";case 29986:case 29987:return"CH340";case 21778:case 21795:case 21892:return"CH341";case 1026:case 1027:case 1028:case 1029:case 24577:case 1538:case 24592:return"FT232";case 38144:case 258:case 1281:case 32937:case 6e4:case 60001:case 60003:return"CP210x"}return"Unknown"}async select(){if(this._ok){try{await this.close();let e=await navigator.serial.getPorts();for(let t of e)await t.forget();await navigator.serial.requestPort(),await this._update()}catch(e){this._port=null,this._error(e)}this.onportchange(this.selected())}}async open(e=115200){if(this._ok)try{if(await this.close(),await this._update(),!this.selected())throw"No port";try{await this._port.open({baudRate:e}),this._open=!0,this.onopen(),this.reader.reset(),await this._readLoop()}finally{await this._port.close(),this._open=!1,this.onclose()}}catch(e){this._error(e)}}async close(){if(this._ok&&this._open)for(this._close=!0,this._reader&&await this._reader.cancel();this._open;)await new Promise((e=>setTimeout(e,10)))}async sendBin(e){if(this._ok&&this.opened())try{let t=this._port.writable.getWriter();await t.write(e),t.releaseLock()}catch(e){this._error(e)}}async sendText(e){await this.sendBin((new TextEncoder).encode(e))}reader=new r;_port=null;_open=!1;_close=!1;_reader=null;_error(e){this.onerror("[SerialJS] "+e)}async _update(){let e=await navigator.serial.getPorts();this._port=e.length?e[0]:null}async _readLoop(){for(this._close=!1,this._port.readable&&(this._reader=this._port.readable.getReader());this._port.readable&&!this._close;)try{for(;;){let e=await this._reader.read();if(e.done)break;this.onbin&&this.onbin(e.value),this.ontext&&this.ontext((new TextDecoder).decode(e.value)),this.reader.ontext&&this.reader._write((new TextDecoder).decode(e.value))}}finally{this._reader.releaseLock(),this._reader=null}}}class r{ontext=null;setEOL(e){this._eol=e,this.reset()}reset(){this._buf="",this._skip=!0}_write(e){this._buf+=e;let t=this._buf.split(this._eol);1!=t.length&&(t[t.length-1].length?this._buf=t.pop():(this._buf="",t.pop()),this._skip&&(t.shift(),this._skip=!1),t.map(this.ontext))}_buf="";_skip=!0;_eol=/\r?\n/}var a=t.A;export{a as default};